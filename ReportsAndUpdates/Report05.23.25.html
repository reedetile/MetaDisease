<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Reed Scott">

<title>Report05.03.2025</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="Report05.23.25_files/libs/clipboard/clipboard.min.js"></script>
<script src="Report05.23.25_files/libs/quarto-html/quarto.js"></script>
<script src="Report05.23.25_files/libs/quarto-html/popper.min.js"></script>
<script src="Report05.23.25_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Report05.23.25_files/libs/quarto-html/anchor.min.js"></script>
<link href="Report05.23.25_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Report05.23.25_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Report05.23.25_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Report05.23.25_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Report05.23.25_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Report05.03.2025</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Reed Scott </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>In the last update on this project we had agreed upon a method for simulating the species richness ~ abundance relationship when building our metacommunities. I have simulated 100 meta-communities for us to explore using the rules and parameters we have previously established</p>
<p>In the most recent addition to our manuscript (Metadisease1.3, sent in the same email as this document) I define T and <span class="math inline">\(\Sigma\)</span> (called R and B Mark’s 2020 supplementals). To start, here I provide the code necessary to calculate the T and <span class="math inline">\(\Sigma\)</span> matrices. I then show how I believe these functions should be used in our simulated metacommunities to calculate R<sub>0,L</sub> . My goal is that, assuming you approve of these methods, we can run simulation, calculate R<sub>0L</sub> for each metacommunity and explore the results.</p>
</section>
<section id="the-functions" class="level1">
<h1>The Functions:</h1>
<section id="the-r-or-t-matrix" class="level2">
<h2 class="anchored" data-anchor-id="the-r-or-t-matrix">The R (or T) matrix</h2>
<p>To build the R matrix, we require 5 pieces of information: <span class="math inline">\(\beta\)</span>, I, N, S, and P. S defines the number of possible species in the system and P defines the number of patches in the system. <span class="math inline">\(\beta\)</span> is an S x S matrix define transmission rates: <span class="math inline">\(\beta_{ss}\)</span> is intraspecific transmission while <span class="math inline">\(\beta_{si}\)</span> is interspecific transmission. I is an S x P matrix defining the abundance of infectious individuals in each patch. N is also an S x P matrix, but defines the total abundance of each species in each patch. Based on the method of calculating T and T<sub>P</sub> we can calculate R using the following code:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>build_R_with_data_freq <span class="ot">&lt;-</span> <span class="cf">function</span>(beta,I,N,S,P) {</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  fullR <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">data =</span> <span class="dv">0</span>, <span class="at">nrow =</span> P<span class="sc">*</span>S, <span class="at">ncol =</span> P<span class="sc">*</span>S)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (p <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>P) {</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    Rmat <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">data =</span> <span class="dv">0</span>, <span class="at">nrow =</span> S, <span class="at">ncol =</span> S)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (s <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>S){</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>S){</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>        Rmat[i,s] <span class="ot">&lt;-</span> (beta[s,i]<span class="sc">*</span>I[p,i])<span class="sc">/</span><span class="fu">sum</span>(N[p,])</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    start <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(p <span class="sc">==</span> <span class="dv">1</span>, p,(S<span class="sc">*</span>p)<span class="sc">-</span>(S<span class="dv">-1</span>))</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    stop <span class="ot">&lt;-</span> start <span class="sc">+</span> S <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    fullR[start<span class="sc">:</span>stop, start<span class="sc">:</span>stop] <span class="ot">&lt;-</span> Rmat</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(fullR)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here, we are defining the full matrix R, ofr”fullR” as a matrix with dimensions {P*S,P*S}. We then define a submatrix Rmat, for each patch, where <span class="math inline">\(Rmat_{i,s} = (\beta_{i,s}*I_{p,i})/\sum(N_s)\)</span> where <span class="math inline">\(\beta_{i,s}\)</span> is the transmission coefficient between infectious individuals of species i and susceptible individuals of species s.</p>
</section>
<section id="the-b-or-sigma-matrix" class="level2">
<h2 class="anchored" data-anchor-id="the-b-or-sigma-matrix">The B (or <span class="math inline">\(\Sigma\)</span> matrix)</h2>
<p>While the R matrix had to change its calculations compared to Wilber 2020, the B matrix remains largely unchanged. In the Metadisease1.3 we define 2 submatrices of the B matrix, D and E (originally defined in Mark’s 2020 supplementals). In addition to parameters S and P we also define the B matrix using Cmat (the matrix of connectivity between patches), <span class="math inline">\(\phi\)</span> (the dispersal rate of a species), and b (the loss rate of the disease, defined by recovery + death).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>build_B_with_data <span class="ot">&lt;-</span> <span class="cf">function</span>(Cmat, phi, b, S, P) {</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  Cmat_axis <span class="ot">&lt;-</span> <span class="fu">colSums</span>(Cmat)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  diag_list <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">"list"</span>,P<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  diag_list_names <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="at">dim =</span> <span class="fu">c</span>(<span class="fu">sqrt</span>(<span class="fu">length</span>(diag_list)), <span class="fu">sqrt</span>(<span class="fu">length</span>(diag_list))))</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (p <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>P) { <span class="co">#loop over columns</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>P) { <span class="co">#loop over rows</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>      diag_list_names[j,p] <span class="ot">&lt;-</span> <span class="fu">paste</span>(p,j,<span class="at">sep=</span><span class="st">"_"</span>)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  diag_list_names <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(diag_list_names)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(diag_list) <span class="ot">&lt;-</span> diag_list_names</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (p <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>P) { <span class="co">#loop over columns</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>P) { <span class="co">#loop over rows</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>      tZ <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>,<span class="at">nrow =</span> S, <span class="at">ncol =</span> S)</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>      new_diag <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="at">dim =</span> S)</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>      new_diag <span class="ot">&lt;-</span> <span class="cf">if</span>(p <span class="sc">==</span> j){</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>        <span class="co">#build the diagonal matrix</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>        (<span class="sc">-</span><span class="dv">1</span>)<span class="sc">*</span>b <span class="sc">-</span> phi<span class="sc">*</span>Cmat_axis[p]</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span>{</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>        phi<span class="sc">*</span>Cmat[j,p]</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>      <span class="fu">diag</span>(tZ) <span class="ot">&lt;-</span> new_diag</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>      x <span class="ot">&lt;-</span> <span class="fu">paste</span>(p,j,<span class="at">sep=</span><span class="st">"_"</span>)</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>      diag_list[[x]] <span class="ot">&lt;-</span> tZ </span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>  diag_matrix <span class="ot">&lt;-</span> <span class="fu">matrix</span>(diag_list, <span class="at">nrow =</span> P, <span class="at">ncol =</span> P)</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>  tB <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>P) {</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>    tB[[j]] <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">data =</span> <span class="fu">unlist</span>(diag_matrix[j,]), <span class="at">nrow =</span> S<span class="sc">*</span>P, <span class="at">ncol =</span> S, <span class="at">byrow =</span> T) <span class="co">#looks like this worked!</span></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>  B <span class="ot">&lt;-</span> <span class="fu">do.call</span>(cbind, tB[<span class="dv">1</span><span class="sc">:</span>P]) <span class="co">#need to determine if this is what B should look like</span></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(B) </span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>I’d say the most important thing to pay attention to is the if…else statement. If p = j, then we are along the diagonal of the matrix and thus use the formula <span class="math inline">\((-1)b - \phi*CmatAxis[p]\)</span> . If we are off the diagonal we use the formula <span class="math inline">\(\phi * Cmat\)</span>.</p>
</section>
<section id="the-k-matrix" class="level2">
<h2 class="anchored" data-anchor-id="the-k-matrix">The K matrix</h2>
<p>The final product we need to calculate R<sub>0,L</sub> is the matrix K. this is defined by</p>
<p><span class="math display">\[
K = max eig (R*-B^{-1})
\]</span></p>
<p>We already have the process for defining R and B. Now we just need to use matrix multiplication to get K.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>landscape_R0_freq <span class="ot">&lt;-</span> <span class="cf">function</span>(beta,I,N,Cmat,b, phi,S,P){</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  R <span class="ot">&lt;-</span> <span class="fu">build_R_with_data_freq</span>(<span class="at">beta =</span> beta,</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">I =</span> I,</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">N =</span> N,</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>                         <span class="at">S =</span> S,</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>                         <span class="at">P =</span> P)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  B <span class="ot">&lt;-</span> <span class="fu">build_B_with_data</span>(<span class="at">Cmat =</span> Cmat,</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>                         <span class="at">phi =</span> phi,</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>                         <span class="at">b =</span> b,</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>                         <span class="at">S =</span> S,</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>                         <span class="at">P =</span> P)</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  K <span class="ot">&lt;-</span> R <span class="sc">%*%</span> <span class="fu">solve</span>(<span class="sc">-</span><span class="dv">1</span><span class="sc">*</span>B)</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">K =</span> K, <span class="at">R =</span> R, <span class="at">B =</span> B))</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="an-example" class="level2">
<h2 class="anchored" data-anchor-id="an-example">An example</h2>
<p>Let’s take an example and see if it works as expected. We’ll define a 2 species, 2 patch system. We’ll randomly define values for b, <span class="math inline">\(\phi\)</span>, <span class="math inline">\(\beta\)</span>, and N. We’ll define S (abundance of susceptible individuals) as a proportion of N and I = N-S. With all of that defined we can then run each function and see if they work.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>Spp <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="co">#number of species</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>Patches <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="co">#number of patches</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> Spp, <span class="at">mean =</span> <span class="dv">1</span>, <span class="at">sd =</span> <span class="fl">0.1</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>phi <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="dv">2</span>, <span class="at">mean =</span> <span class="fl">0.5</span>, <span class="at">sd =</span> <span class="fl">0.1</span>)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co">#transmission</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>beta <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">data =</span> <span class="cn">NA</span>, <span class="at">nrow =</span> Spp, <span class="at">ncol =</span> Spp)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(beta)) {</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(beta)) {</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    beta[i,j] <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(i <span class="sc">==</span> j, <span class="fu">rbeta</span>(<span class="at">n =</span> <span class="dv">1</span>, <span class="at">shape1 =</span> <span class="dv">2</span>, <span class="at">shape2 =</span> <span class="dv">10</span>),<span class="fu">rbeta</span>(<span class="at">n =</span> <span class="dv">1</span>, <span class="at">shape1 =</span> <span class="dv">1</span>, <span class="at">shape2 =</span> <span class="dv">1</span>))</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="co">#connectivity</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>Cmat <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">data =</span> <span class="fu">rnorm</span>(<span class="at">n =</span> Patches<span class="sc">^</span><span class="dv">2</span>, <span class="at">mean =</span> <span class="fl">0.5</span>, <span class="at">sd =</span> <span class="fl">0.1</span>),</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">nrow =</span> Patches,</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>            <span class="at">ncol =</span> Patches)</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">rep</span>(<span class="cn">NA</span>,<span class="dv">4</span>), <span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">ncol =</span> <span class="dv">2</span>)</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>N[,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">2</span>, <span class="at">min =</span> <span class="dv">10</span>, <span class="at">max =</span> <span class="dv">20</span>)</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>){</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>  N[i,<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">1</span>, <span class="at">min =</span> <span class="dv">1</span>, <span class="at">max =</span> N[i,<span class="dv">1</span>])</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>S <span class="ot">&lt;-</span> N<span class="sc">*</span><span class="fu">c</span>(<span class="fl">0.8</span>,<span class="fl">0.95</span>)</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>I <span class="ot">&lt;-</span> N <span class="sc">-</span> S</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>r_freq <span class="ot">&lt;-</span> <span class="fu">build_R_with_data_freq</span>(<span class="at">beta =</span> beta,</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">I =</span> I,</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">N =</span> N,</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">S =</span> Spp,</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">P =</span> Patches)</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>B <span class="ot">&lt;-</span> <span class="fu">build_B_with_data</span>(<span class="at">Cmat =</span> Cmat,</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>                       <span class="at">phi =</span> phi,</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>                       <span class="at">b =</span> b, </span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>                       <span class="at">S =</span> Spp,</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>                       <span class="at">P =</span> Patches)</span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Not currently working. Need to probably adjust B matrix</span></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>K_freq <span class="ot">&lt;-</span> <span class="fu">landscape_R0_freq</span>(<span class="at">beta =</span> beta,</span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>                            <span class="at">I =</span> I,</span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>                            <span class="at">N =</span> N,</span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>                            <span class="at">Cmat =</span> Cmat,</span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>                            <span class="at">b =</span> b,</span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>                            <span class="at">phi =</span> phi,</span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>                            <span class="at">S =</span> Spp,</span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>                            <span class="at">P =</span> Patches)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now let’s check each and see if they worked:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>r_freq</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           [,1]        [,2]        [,3]        [,4]
[1,] 0.02966232 0.091686107 0.000000000 0.000000000
[2,] 0.02211440 0.007612382 0.000000000 0.000000000
[3,] 0.00000000 0.000000000 0.006044955 0.018684928
[4,] 0.00000000 0.000000000 0.007338430 0.002526089</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>B</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           [,1]      [,2]       [,3]       [,4]
[1,] -1.3992400  0.000000  0.2500682  0.0000000
[2,]  0.0000000 -1.254567  0.0000000  0.1090908
[3,]  0.2751875  0.000000 -1.3979568  0.0000000
[4,]  0.0000000  0.120049  0.0000000 -1.2540068</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>K_freq[[<span class="dv">1</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            [,1]         [,2]        [,3]         [,4]
[1,] 0.021971861 0.0736953671 0.003930354 0.0064110401
[2,] 0.016380863 0.0061186732 0.002930229 0.0005322866
[3,] 0.000881434 0.0014377608 0.004481807 0.0150252569
[4,] 0.001070040 0.0001943766 0.005440807 0.0020313237</code></pre>
</div>
</div>
<p>Looks like about what I’d expect! And if we take the max eigenvalue of that, that should be our R<sub>0,L</sub></p>
</section>
</section>
<section id="applying-functions-to-our-metacommunities" class="level1">
<h1>Applying functions to our metacommunities</h1>
<p>Our goal in this project is to assess how <strong>dissimilarity of communities</strong> affects R<sub>0,L</sub>. Previously, we have talked about how to simulate community structure so I’m not going to discuss it much here. You can see the methods section of Metadisease1.3, “Establishing meta-communities” and Figure 1 to see that this uses a saturated curve.</p>
<p>Here, I provide the methods in terms of the code. I am using I am using a two patch meta-community to start, although I think this can be upscaled relatively easily. We have to set the number of patches (2), number of species (6), birth (0 because this is a single season model), death (d), recovery (v), <span class="math inline">\(\phi\)</span> (dispersal), <span class="math inline">\(\beta\)</span> (transmission coefficient), and c(connectivity). I do not show the code here but am happy to continue discussion of parameter value selection.</p>
<p>I do want to take a second to discuss the simulation of <span class="math inline">\(\beta\)</span>. Originally, I had defined both intraspecific and interspecific <span class="math inline">\(\beta\)</span> using the beta distribution. however, when I did, I found that the values of interspecific <span class="math inline">\(\beta\)</span> were incredibly small. This could easily be adjusted, and for now I have arbitrarily defined interspecific <span class="math inline">\(\beta\)</span> as 0.85*intraspecific <span class="math inline">\(\beta\)</span>. However, I think this could showcase how important the specifications for <span class="math inline">\(\beta\)</span> are (and that I may need to do a bit more literature review).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>trans_rate <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">n =</span> <span class="dv">1</span>,<span class="at">x =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="at">length =</span> <span class="dv">100</span>),a,b){</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  trans <span class="ot">&lt;-</span> <span class="fu">rbeta</span>(<span class="at">n =</span> n, <span class="at">shape1 =</span> a, <span class="at">shape2 =</span> b)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(trans)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="co"># PREG</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>intra_PREG <span class="ot">&lt;-</span> <span class="fu">trans_rate</span>(<span class="at">a =</span> <span class="dv">4</span>,<span class="at">b =</span> <span class="dv">2</span>)</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>inter_PREG <span class="ot">&lt;-</span> intra_PREG<span class="sc">*</span><span class="fl">0.85</span> <span class="co">#trans_rate(a = 4, b = 2.5)</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="co"># TGRAN</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>intra_TGRAN <span class="ot">&lt;-</span> <span class="fu">trans_rate</span>(<span class="at">a =</span> <span class="dv">4</span>, <span class="at">b =</span> <span class="fl">2.25</span>)</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>inter_TGRAN <span class="ot">&lt;-</span> intra_TGRAN<span class="sc">*</span><span class="fl">0.85</span> <span class="co">#trans_rate(a = 4, b = 2.5)</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a><span class="co">#TTOR</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>intra_TTOR <span class="ot">&lt;-</span> <span class="fu">trans_rate</span>(<span class="at">a =</span> <span class="dv">3</span>, <span class="at">b =</span> <span class="fl">2.5</span>)</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>inter_TTOR <span class="ot">&lt;-</span> intra_TTOR<span class="sc">*</span><span class="fl">0.85</span> <span class="co">#trans_rate(a = 3, b = 2.75)</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a><span class="co">#ABOR</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>intra_ABOR <span class="ot">&lt;-</span> <span class="fu">trans_rate</span>(<span class="at">a =</span> <span class="fl">2.5</span>, <span class="at">b =</span> <span class="fl">2.75</span>)</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>inter_ABOR <span class="ot">&lt;-</span> intra_ABOR<span class="sc">*</span><span class="fl">0.85</span> <span class="co">#trans_rate(a = 2.5, b = 3.0)</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a><span class="co">#RCAT</span></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>intra_RCAT <span class="ot">&lt;-</span> <span class="fu">trans_rate</span>(<span class="at">a =</span> <span class="fl">2.0</span>, <span class="at">b =</span> <span class="fl">3.0</span>)</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>inter_RCAT <span class="ot">&lt;-</span> intra_RCAT<span class="sc">*</span><span class="fl">0.85</span> <span class="co">#trans_rate(a = 2.0, b = 3.25)</span></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a><span class="co">#RDRAY</span></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>intra_RDRAY <span class="ot">&lt;-</span> <span class="fu">trans_rate</span>(<span class="at">a =</span> <span class="fl">1.5</span>, <span class="at">b =</span> <span class="fl">3.25</span>)</span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>inter_RDRAY <span class="ot">&lt;-</span> intra_RDRAY<span class="sc">*</span><span class="fl">0.85</span><span class="co">#trans_rate(a = 1.5, b = 3.5)</span></span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>beta <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">data =</span> <span class="cn">NA</span>, <span class="at">nrow =</span> num_spp, <span class="at">ncol =</span> num_spp)</span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(beta)) {</span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(beta)) {</span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>    beta[i,j] <span class="ot">&lt;-</span> <span class="cf">if</span>(i <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> j <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>      intra_PREG}<span class="cf">else</span> <span class="cf">if</span>(i <span class="sc">!=</span> <span class="dv">1</span> <span class="sc">&amp;</span> j <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a>        inter_PREG} <span class="cf">else</span> <span class="cf">if</span>(i <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> j <span class="sc">==</span> <span class="dv">2</span>){</span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a>          intra_TGRAN} <span class="cf">else</span> <span class="cf">if</span>(i <span class="sc">!=</span> <span class="dv">2</span> <span class="sc">&amp;</span> j <span class="sc">==</span> <span class="dv">2</span>){</span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>            inter_TGRAN} <span class="cf">else</span> <span class="cf">if</span>(i <span class="sc">==</span> <span class="dv">3</span> <span class="sc">&amp;</span> j <span class="sc">==</span> <span class="dv">3</span>){</span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a>              intra_TTOR} <span class="cf">else</span> <span class="cf">if</span>(i <span class="sc">!=</span> <span class="dv">3</span> <span class="sc">&amp;</span> j <span class="sc">==</span> <span class="dv">3</span>){</span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a>                inter_TTOR} <span class="cf">else</span> <span class="cf">if</span>(i <span class="sc">==</span> <span class="dv">4</span> <span class="sc">&amp;</span> j <span class="sc">==</span> <span class="dv">4</span>){</span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a>                  intra_ABOR} <span class="cf">else</span> <span class="cf">if</span>(i <span class="sc">!=</span> <span class="dv">4</span> <span class="sc">&amp;</span> j <span class="sc">==</span> <span class="dv">4</span>){</span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a>                    inter_ABOR} <span class="cf">else</span> <span class="cf">if</span>(i <span class="sc">==</span> <span class="dv">5</span> <span class="sc">&amp;</span> j <span class="sc">==</span> <span class="dv">5</span>){</span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a>                      intra_RCAT} <span class="cf">else</span> <span class="cf">if</span>(i <span class="sc">!=</span> <span class="dv">5</span> <span class="sc">&amp;</span> j <span class="sc">==</span><span class="dv">5</span>){</span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a>                        inter_RCAT} <span class="cf">else</span> <span class="cf">if</span>(i <span class="sc">==</span> <span class="dv">6</span> <span class="sc">&amp;</span> j <span class="sc">==</span> <span class="dv">6</span>){</span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a>                          intra_RDRAY} <span class="cf">else</span> <span class="cf">if</span>(i <span class="sc">!=</span> <span class="dv">6</span> <span class="sc">&amp;</span> j <span class="sc">==</span> <span class="dv">6</span>){</span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a>                            inter_RDRAY}</span>
<span id="cb11-47"><a href="#cb11-47" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb11-48"><a href="#cb11-48" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now with that in mind I can show the for loops used to actually calculate R<sub>0,L</sub> . I first defined a dataframe that we will use to store our results. I then ran a for loop where for each metacommunity “a” we established the total (N) susceptible (S) Infectious (I) abundance for each species. We can calculate total abundance for each metacommunity (TotalAbundance) as well as the abundance of each species. We can then measure <strong>dissimilarity</strong> of the two patches within the metacommunity (which I call beta_diversity… that may not be correct). I also measure gamma diversity for good measure. With all of this, we then have the necessary variables to calculate R<sub>0,L</sub> using the landscape_R0_freq() function. And I believe… that’s everything required. That should be the whole model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">matrix</span>(<span class="at">data =</span> <span class="cn">NA</span>, <span class="at">nrow =</span> <span class="fu">length</span>(meta_comm_list), <span class="at">ncol =</span> <span class="dv">17</span>))</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(result) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"TotalAbundance"</span>,<span class="st">"PREG"</span>,<span class="st">"TGRAN"</span>,<span class="st">"TTOR"</span>,<span class="st">"ABOR"</span>,<span class="st">"RCAT"</span>,<span class="st">"RDRAY"</span>,<span class="st">"BetaDiversity"</span>,<span class="st">"Gamma_diversity"</span>,<span class="st">"LandscapeR0"</span>, <span class="st">"MetaCommID"</span>)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (a <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(meta_comm_list)) {</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  S <span class="ot">&lt;-</span> meta_comm_list[[a]][,<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>]<span class="sc">*</span><span class="fu">c</span>(<span class="fl">0.5</span>,<span class="fl">0.6</span>,<span class="fl">0.70</span>,<span class="fl">0.8</span>,<span class="fl">0.80</span>,.<span class="dv">9</span>) <span class="co">#value of susceptibles</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  I <span class="ot">&lt;-</span> meta_comm_list[[a]][,<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>] <span class="sc">-</span> S <span class="co">#value of infecteds</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  N <span class="ot">&lt;-</span> S<span class="sc">+</span>I <span class="co">#total pop of a patch</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  S <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(S)</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  I <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(I)</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>  N <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(N)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>  N_meta <span class="ot">&lt;-</span> <span class="fu">colSums</span>(N)</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>  b <span class="ot">&lt;-</span> v <span class="sc">+</span> d  <span class="co"># total loss rate</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate variables</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>  result[a,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">sum</span>(N) <span class="co">#total abundance</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>  <span class="co">#abdunance of each species</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>(<span class="dv">1</span><span class="sc">+</span>num_spp)) {</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    result[a,i] <span class="ot">&lt;-</span> <span class="fu">sum</span>(N[,i<span class="dv">-1</span>])</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    result[a,(i<span class="sc">+</span>num_spp)] <span class="ot">&lt;-</span> result[a,i]<span class="sc">/</span>result[a,<span class="dv">1</span>]</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>  <span class="co">#add beta diversity</span></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>  beta_diversity <span class="ot">&lt;-</span> <span class="fu">betadiver</span>(N, <span class="at">method =</span> <span class="st">'sor'</span>)</span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>  result[a,<span class="dv">14</span>] <span class="ot">&lt;-</span> <span class="fu">mean</span>(beta_diversity, <span class="at">na.rm =</span>T) <span class="co">#beta diversity</span></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>  result[a,<span class="dv">15</span>] <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">ifelse</span>(result[a,<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>] <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="dv">1</span>,<span class="dv">0</span>)) <span class="co">#gamma diversity</span></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>  <span class="co">#calculate landscape R0</span></span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>  r0_landscape <span class="ot">&lt;-</span> <span class="fu">landscape_R0_freq</span>(<span class="at">beta =</span> beta,</span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">I =</span> I,</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">N =</span> N,</span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">Cmat =</span> c,</span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">b =</span> b,</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">phi =</span> phi,</span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">S =</span> num_spp,</span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">P =</span> num_patches)</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a>  result[a,<span class="dv">16</span>] <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="fu">abs</span>(<span class="fu">eigen</span>(r0_landscape[[<span class="dv">1</span>]])<span class="sc">$</span>values)) <span class="co">#landscape R0</span></span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a>  result[a,<span class="dv">17</span>] <span class="ot">&lt;-</span> a <span class="co">#metacommunity ID</span></span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="next-steps" class="level1">
<h1>Next steps</h1>
<p>First, I believe that I need to reassess how <span class="math inline">\(\beta\)</span> transmission is determined. Although I don’t show it here, I redid some of the sensitivity analysis I did earlier and found that R<sub>0,L</sub> is strongly correlated with <span class="math inline">\(\beta\)</span>. As I said above, this could include some further literature review.</p>
<p>Additionally, my chosen values for S and I are currently arbitrary. I think we’re far enough along that I need to do some digging to determine realistic values of prevalence for each host species. I also think that this has led to a change in an underlying question you both asked earlier: I think that this is going to be a simulation assessing a system at equilibrium and not necessarily exploring invasion dynamics.</p>
<p>Now, assuming my math is correct, and that my implementation via code is correct, I believe that the next step is analysis of the model. We could just use a GLM. Although <span class="citation" data-cites="mihaljevic2014">Mihaljevic et al. (<a href="#ref-mihaljevic2014" role="doc-biblioref">2014</a>)</span> used a GAM I’m not sure we’re expecting any non-linear relationship so not sure that’s a good fit? I am open to either though. And I think we could fit 3 models:</p>
<ol type="1">
<li><p>a null model</p></li>
<li><p><span class="math inline">\(R_{0,L}\)</span> ~ <span class="math inline">\(\beta\)</span> and</p></li>
<li><p><span class="math inline">\(R_{0,L}\)</span> ~ <span class="math inline">\(\gamma\)</span></p>
<p>to see how the models perform. I think it would also make sense to include graphs of each model.</p></li>
</ol>
<p>and see how the models perform. I think it would also make sense to include graphs of <span class="math inline">\(R_{0,L}\)</span> ~ <span class="math inline">\(\beta\)</span> and <span class="math inline">\(R_{0,L}\)</span> ~ <span class="math inline">\(\gamma\)</span>.</p>

</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-mihaljevic2014" class="csl-entry" role="listitem">
Mihaljevic, Joseph R., Maxwell B. Joseph, Sarah A. Orlofske, and Sara H. Paull. 2014. <span>“The Scaling of Host Density with Richness Affects the Direction, Shape, and Detectability of Diversity-Disease Relationships.”</span> Edited by Delmiro Fernandez-Reyes. <em>PLoS ONE</em> 9 (5): e97812. <a href="https://doi.org/10.1371/journal.pone.0097812">https://doi.org/10.1371/journal.pone.0097812</a>.
</div>
</div></section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>